<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <!-- ðŸ“Œ Chart.js CDN goes in HEAD -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Welcome, {{ name }}!</h1>

  <h2>Your Suggested Workouts:</h2>
  <ul>
    {% for workout in workouts %}
      <li>{{ workout }}</li>
    {% endfor %}
  </ul>

  <h2>Your Suggested Meals:</h2>
  <ul>
    {% for meal in meals %}
      <li>{{ meal }}</li>
    {% endfor %}
  </ul>

  <h2>Latest AI Recommendation:</h2>
  <p>{{ recommendation }}</p>

  <h2>Update Your Progress</h2>
  <form method="post" action="{{ url_for('progress') }}">
    <label>Today's Weight (kg):</label><br>
    <input name="weight" type="number" step="0.1" required><br>
    <label>Calories Eaten:</label><br>
    <input name="calories" type="number" required><br>
    <label>Notes:</label><br>
    <textarea name="notes"></textarea><br>
    <button type="submit">Submit Progress</button>
  </form>

  <h2>Your Progress</h2>
  <canvas id="weightChart" width="400" height="200"></canvas>
  <canvas id="caloriesChart" width="400" height="200"></canvas>

  <br><br>
  <a href="{{ url_for('profile') }}">Edit Profile</a>
  <br><br>
  <a href="{{ url_for('logout') }}">Logout</a>

  <!-- ðŸ“Œ Chart.js config goes just before </body> -->
  <!-- âœ… Put this just before </body> -->
<script>
  // âœ… Declare once, from Flask context, always use tojson filter!
  const dates = {{ dates | tojson | safe }};
  const weights = {{ weights | tojson | safe }};
  const calories = {{ calories | tojson | safe }};

  console.log("Dates:", dates);
  console.log("Weights:", weights);
  console.log("Calories:", calories);

  // âœ… Weight Chart
  const ctxW = document.getElementById('weightChart').getContext('2d');
  new Chart(ctxW, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        label: 'Weight (kg)',
        data: weights,
        borderColor: 'blue',
        fill: false,
        tension: 0.1
      }]
    },
    options: {
      responsive: true
    }
  });

  // âœ… Calories Chart
  const ctxC = document.getElementById('caloriesChart').getContext('2d');
  new Chart(ctxC, {
    type: 'bar',
    data: {
      labels: dates,
      datasets: [{
        label: 'Calories',
        data: calories,
        backgroundColor: 'orange'
      }]
    },
    options: {
      responsive: true
    }
  });
</script>

</body>
</html>
